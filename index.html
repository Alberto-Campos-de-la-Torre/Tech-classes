<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summative Exam: Digital Activism Campaign</title>
    <style>
        :root {
            --primary-color: #005A9C;
            --secondary-color: #f8f9fa; /* Very light grey for elements */
            --text-color: #333;
            --accent-color: #FFC107;
            --card-bg: #ffffff; /* Card background remains white */
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
            --correct-bg: #d4edda;
            --incorrect-bg: #f8d7da;
            --correct-text: #155724;
            --incorrect-text: #721c24;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --border-color: #dee2e6; /* Added border color variable */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align top for long content */
            min-height: 100vh;
            padding: 20px 0; /* Add padding for scroll */
        }

        .quiz-container {
            width: 90%;
            max-width: 800px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin: 20px 0;
            overflow: hidden;
            position: relative; /* Needed for absolute positioning of overlay if NOT fixed */
        }

        header {
            background: var(--primary-color);
            color: #fff;
            padding: 1.5rem 2rem;
            text-align: center;
        }

        header h1 { margin: 0; font-size: 1.8rem; }
        header p { margin: 5px 0 0 0; font-size: 1rem; opacity: 0.9; }

        #quiz-form, #results-container {
            padding: 2rem;
        }

        .warning-banner {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #ffeeba;
            font-size: 0.9rem;
        }

        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .question-block:last-of-type {
            border-bottom: none;
            margin-bottom: 1rem;
        }

        .question-text {
            font-size: 1.15rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .answer-options label {
            display: block;
            background-color: var(--secondary-color);
            padding: 0.9rem;
            margin-bottom: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: 1px solid var(--border-color);
        }
        .answer-options label:hover {
            background-color: #e9ecef;
        }
        .answer-options input[type="radio"] {
            margin-right: 10px;
        }

        .open-ended-answer textarea {
            width: 98%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            margin-top: 10px;
            background-color: #fff;
        }

        .quiz-button {
            display: block;
            width: 100%;
            padding: 1rem;
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 1.5rem;
        }
        .quiz-button:hover {
            background-color: #e0a800;
        }

        /* Results Section */
        #results-container { display: none; }

        #results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }
        #results-table th, #results-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        #results-table th {
            background-color: var(--primary-color);
            color: white;
        }
        #results-table tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        .open-answer-cell {
            white-space: pre-wrap;
            font-style: italic;
            color: #555;
        }

        .correct-answer-cell {
             font-weight: bold;
             color: var(--correct-text);
        }

        .correct-row td:first-child::before {
             content: '✔ ';
             color: var(--correct-text);
             font-weight: bold;
        }
        .incorrect-row td:first-child::before {
             content: '✘ ';
             color: var(--incorrect-text);
             font-weight: bold;
        }
         .incorrect-row .user-answer-cell {
           text-decoration: line-through;
           opacity: 0.7;
         }
        .open-ended-row td:first-child::before {
             content: '✎ ';
             color: var(--primary-color);
             font-weight: bold;
        }

        #reveal-section {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }
        #password-input {
            flex-grow: 1;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }
        #reveal-button {
            padding: 0.8rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }
        #password-error {
            color: var(--incorrect-text);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        /* Termination Overlay */
        #termination-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
        }
        #termination-overlay h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }
        #termination-overlay p {
            font-size: 1.2rem;
            max-width: 80%;
            margin-bottom: 1.5rem;
            color: white;
        }
        #retry-section {
            margin-top: 1rem;
            display: flex;
            gap: 10px;
            width: 80%;
            max-width: 400px;
            align-items: center;
        }
        #retry-password-input {
            flex-grow: 1;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: white;
            color: #333;
            font-size: 1rem;
        }
        #retry-button {
             padding: 0.8rem 1.5rem;
             background-color: var(--accent-color);
             color: var(--text-color);
             border: none;
             border-radius: 5px;
             cursor: pointer;
             white-space: nowrap;
             font-weight: bold;
             font-size: 1rem;
        }
         #retry-button:hover {
           background-color: #e0a800;
         }
        #retry-error {
            color: #f8d7da;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
            width: 80%;
            max-width: 400px;
        }

        /* PDF Save Instructions */
        .save-pdf-instructions {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        .save-pdf-instructions h3 {
             color: var(--primary-color);
             margin-top: 0;
        }
        .save-pdf-instructions ol {
             padding-left: 20px;
        }
         .save-pdf-instructions li {
             margin-bottom: 8px;
         }

    </style>
</head>
<body>

    <div class="quiz-container">
        <div id="termination-overlay">
            <h2>Exam Finished</h2>
            <p id="termination-message">The assessment has ended automatically.</p>
            <div id="retry-section">
                <input type="password" id="retry-password-input" placeholder="Password to retry">
                <button type="button" id="retry-button">Retry Exam</button>
            </div>
            <p id="retry-error">Incorrect password.</p>
        </div>

        <header>
            <h1>Summative Exam</h1>
            <p>Digital Activism Campaign</p>
        </header>

        <div class="warning-banner">
            ⚠️ Attention: If you switch tabs or reload the page, the exam will end automatically. You can retry with the password if this occurs.
        </div>

        <form id="quiz-form">
            <button type="submit" class="quiz-button">Finish Exam</button>
        </form>

        <div id="results-container">
            <h2>Your Answers</h2>
            <p>Here is a summary of the answers you selected. To see the correct answers for the multiple-choice questions, enter the password.</p>
            <table id="results-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Your Answer</th>
                        </tr>
                </thead>
                <tbody id="results-body">
                    </tbody>
            </table>
            <div id="reveal-section">
                <input type="password" id="password-input" placeholder="Enter the password">
                <button type="button" id="reveal-button">Reveal Answers</button>
            </div>
            <p id="password-error">Incorrect password. Try again.</p>

            <div class="save-pdf-instructions">
                <h3>Save Answers as PDF</h3>
                <p>Once you have revealed the correct answers, you can save this page as a PDF file for your records:</p>
                <ol>
                    <li>Press <strong>Ctrl + P</strong> (on Windows/Linux) or <strong>Cmd + P</strong> (on Mac) to open the print dialog.</li>
                    <li>In the "Destination" or "Printer" field, select the <strong>"Save as PDF"</strong> or "Microsoft Print to PDF" option.</li>
                    <li>Adjust any other settings if necessary (like 'Layout' to 'Portrait').</li>
                    <li>Click <strong>"Save"</strong> and choose where you want to save the PDF file.</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // --- COOKIE HELPER FUNCTIONS ---
        function setCookie(name, value, minutes) {
            let expires = "";
            if (minutes) {
                const date = new Date();
                date.setTime(date.getTime() + (minutes * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function deleteCookie(name) {
             document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; SameSite=Lax';
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- QUIZ DATA ---
             const quizData = [
                 // Q1 (Multiple Choice)
                { question: "In your own campaign, what was the primary purpose of defining the Mission, Vision, and Values?", options: ["To create a mandatory document for the portfolio.", "To establish the central identity and purpose of the campaign to guide all decisions.", "To choose the colors and fonts for the website.", "To decide which pages to include in the site map."], answer: 1, type: "mc" },
                // Q2 (Multiple Choice)
                { question: "Which of the following actions best represents the creation of an 'Active Digital Footprint'?", options: ["Visiting a website that uses cookies to track your browsing.", "An application collecting data about how long you use it.", "Posting a photo and a comment on a social network about your campaign.", "Receiving a marketing email based on your searches."], answer: 2, type: "mc" },
                 // Q3 (Multiple Choice)
                { question: "When designing your campaign's website, why was it important to create a 'Wireframe' before starting to build in Wix?", options: ["To choose the correct Wix template.", "To plan the structure, layout, and visual hierarchy of the content without design distractions.", "To write the final copy for the homepage.", "To test if the internal links were working correctly."], answer: 1, type: "mc" },
                 // Q4 (Multiple Choice)
                { question: "Imagine you find an online article with impactful statistics about your campaign's cause. According to the C.R.A.P. test, what is the MOST important first step before using that information on your site?", options: ["Check the 'Currency': Is the information recent?", "Check the 'Authority': Who is the author or source? Are they credible experts?", "Check the 'Relevance': Does it directly answer your campaign's questions?", "Check the 'Purpose': Is the article trying to inform, persuade, or sell something?"], answer: 1, type: "mc" },
                 // Q5 (Multiple Choice)
                { question: "On your 'Get Involved' page, why is it important to offer different ways for people to support your cause?", options: ["To make the page longer and more complete.", "To allow people with different levels of commitment (time, money, skills) to participate.", "To meet the minimum requirements of the rubric.", "To be able to add more buttons and links to the website."], answer: 1, type: "mc" },
                 // Q6 (Multiple Choice)
                { question: "Define 'Web Accessibility' in the context of your campaign.", options: ["That the website loads quickly on any device.", "That the website's design is modern and visually attractive.", "Designing your website so it can be used by people with diverse abilities (visual, auditory, motor, cognitive).", "Ensuring the website is available in multiple languages."], answer: 2, type: "mc" },
                 // Q7 (Multiple Choice)
                { question: "If you accidentally share a false news story about your cause because you believed it was true, how is that action classified?", options: ["Disinformation", "Clickbait", "Misinformation", "Freedom of speech"], answer: 2, type: "mc" },
                 // Q8 (Multiple Choice)
                { question: "When writing the content for your homepage, what does the 'Above the fold' concept mean?", options: ["The website's footer.", "All content visible on the screen without needing to scroll.", "The main navigation menu.", "The most important content on the entire website."], answer: 1, type: "mc" },
                 // Q9 (Multiple Choice)
                { question: "Sections like 'Blog/News' and 'FAQ' were added. What is the primary strategic goal of including these sections on your campaign site?", options: ["To increase the total number of pages on the website.", "To offer more opportunities to add images and videos.", "To provide updated information, answer common questions, and keep the audience engaged long-term.", "To make it easier for team members to practice writing."], answer: 2, type: "mc" },
                 // Q10 (Multiple Choice)
                { question: "The 'I Like, I Wish, What If...' feedback model is used to:", options: ["Harshly criticize other teams' projects.", "Provide structured, positive, and improvement-oriented feedback.", "Decide the final grade for the project.", "Simply say whether you like a website or not."], answer: 1, type: "mc" },
                // --- Open Ended Questions ---
                // Q11 (Open Ended)
                { question: "Briefly describe your campaign's main cause and why your team chose it. What was its 'Origin Story'?", type: "open" },
                // Q12 (Open Ended)
                { question: "What do you believe was the STRONGEST element (content, design, functionality) of your final website, and why?", type: "open" },
                // Q13 (Open Ended)
                { question: "Reflect on your 'Credibility Commitment'. How did your team ensure that the information presented on your website was accurate and responsible?", type: "open" },
                // Q14 (Open Ended)
                { question: "What was the biggest technical or collaborative challenge your team faced during the website's creation, and how did you overcome it?", type: "open" },
                // Q15 (Open Ended)
                { question: "Beyond this project, how will you apply what you've learned about Digital Citizenship and the responsible use of technology in your daily life?", type: "open" }
            ];

            const quizForm = document.getElementById('quiz-form');
            const resultsContainer = document.getElementById('results-container');
            const resultsBody = document.getElementById('results-body');
            const revealButton = document.getElementById('reveal-button');
            const passwordInput = document.getElementById('password-input');
            const passwordError = document.getElementById('password-error');
            const terminationOverlay = document.getElementById('termination-overlay');
            const terminationMessage = document.getElementById('termination-message');
            const retryButton = document.getElementById('retry-button');
            const retryPasswordInput = document.getElementById('retry-password-input');
            const retryError = document.getElementById('retry-error');

            let userAnswers = [];
            let quizFinished = false;
            const correctPassword = 'proteina'; // The password remains the same literal value

            // --- Function to trigger termination ---
            function terminateQuiz(message) {
                 if(quizFinished) return;
                 quizFinished = true;
                 terminationMessage.textContent = message;
                 terminationOverlay.style.display = 'flex';
                 quizForm.style.display = 'none';
                 document.querySelector('.warning-banner').style.display = 'none';
                 resultsContainer.style.display = 'none';
                 setCookie('quizCampaignFinished', 'true', 1440);
                 deleteCookie('quizCampaignInProgress');
            }

            // --- RELOAD & COOKIE CHECK ---
            if (getCookie('quizCampaignFinished') === 'true') {
                 terminateQuiz("You have already completed this exam.");
                 return;
            } else if (getCookie('quizCampaignInProgress') === 'true') {
                 terminateQuiz("The exam has ended because the page was reloaded.");
                 return;
            }
            setCookie('quizCampaignInProgress', 'true', 30);

            // --- Load questions into the form ---
            function loadQuiz() {
                 const existingQuestions = quizForm.querySelectorAll('.question-block');
                 existingQuestions.forEach(q => q.remove());

                 const quizHtml = quizData.map((q, index) => {
                     let answerHtml = '';
                     if (q.type === "mc") {
                         const optionsWithIndices = q.options.map((option, i) => ({ text: option, originalIndex: i }));
                         const shuffledOptions = optionsWithIndices.sort(() => Math.random() - 0.5);
                         answerHtml = `<div class="answer-options">` +
                                      shuffledOptions.map(opt => `
                                         <label>
                                             <input type="radio" name="question${index}" value="${opt.originalIndex}" required>
                                             ${opt.text}
                                         </label>
                                     `).join('') +
                                     `</div>`;
                     } else { // Open-ended
                         answerHtml = `<div class="open-ended-answer">
                                         <textarea name="question${index}" placeholder="Write your answer here..." required></textarea>
                                      </div>`;
                     }
                     return `
                         <div class="question-block">
                             <p class="question-text">${index + 1}. ${q.question}</p>
                             ${answerHtml}
                         </div>`;
                 }).join('');
                 const submitButton = quizForm.querySelector('.quiz-button');
                 submitButton.insertAdjacentHTML('beforebegin', quizHtml);
            }

            // --- Handle quiz submission ---
            function submitAndShowResults() {
                 if(quizFinished) return;

                 let allAnswered = true;
                 for (let i = 0; i < quizData.length; i++) {
                     if (quizData[i].type === "mc") {
                         if (!document.querySelector(`input[name="question${i}"]:checked`)) { allAnswered = false; break; }
                     } else {
                         const textarea = document.querySelector(`textarea[name="question${i}"]`);
                         if (!textarea || textarea.value.trim() === "") { allAnswered = false; break; }
                     }
                 }
                 if (!allAnswered) {
                     alert("Please answer all questions before finishing.");
                     return false;
                 }

                 quizFinished = true;
                 setCookie('quizCampaignFinished', 'true', 1440);
                 deleteCookie('quizCampaignInProgress');

                 userAnswers = quizData.map((q, index) => {
                     if (q.type === "mc") {
                         const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                         return selectedOption ? parseInt(selectedOption.value) : -1;
                     } else {
                         const textarea = document.querySelector(`textarea[name="question${index}"]`);
                         return textarea ? textarea.value.trim() : "";
                     }
                 });

                 displayResults();
                 return true;
            }

            quizForm.addEventListener('submit', function(e) {
                 e.preventDefault();
                 submitAndShowResults();
            });

            // --- Display results table ---
            function displayResults() {
                 let tableHtml = '';
                 userAnswers.forEach((answer, questionIndex) => {
                     const question = quizData[questionIndex];
                     let userAnswerText = '';
                     let rowClass = '';
                     if (question.type === "mc") {
                         userAnswerText = (answer === -1) ? "Not answered" : question.options[answer];
                     } else {
                         const tempDiv = document.createElement('div');
                         tempDiv.textContent = answer || "Not answered";
                         userAnswerText = tempDiv.innerHTML;
                         rowClass = 'open-ended-row';
                     }
                     tableHtml += `<tr data-question-index="${questionIndex}" class="${rowClass}"><td>${questionIndex + 1}</td><td class="user-answer-cell ${question.type === 'open' ? 'open-answer-cell' : ''}">${userAnswerText}</td></tr>`;
                 });
                 resultsBody.innerHTML = tableHtml;
                 quizForm.style.display = 'none';
                 document.querySelector('.warning-banner').style.display = 'none';
                 resultsContainer.style.display = 'block';
            }

            // --- Reveal answers logic ---
            revealButton.addEventListener('click', function() {
                 if (passwordInput.value.toLowerCase() === correctPassword) {
                     passwordError.style.display = 'none';
                     let headerRow = document.querySelector('#results-table thead tr');
                     const hasMC = quizData.some(q => q.type === 'mc');
                     if (hasMC && headerRow.cells.length < 3) {
                         const th = document.createElement('th'); th.textContent = 'Correct Answer'; headerRow.appendChild(th);
                     }
                     const rows = resultsBody.querySelectorAll('tr');
                     rows.forEach(row => {
                         const questionIndex = parseInt(row.dataset.questionIndex);
                         const question = quizData[questionIndex];
                         if (question.type === "mc") {
                             if (row.cells.length > 2) return;
                             const userAnswerIndex = userAnswers[questionIndex];
                             const correctAnswerIndex = question.answer;
                             const correctAnswerCell = document.createElement('td');
                             correctAnswerCell.textContent = question.options[correctAnswerIndex];
                             correctAnswerCell.classList.add('correct-answer-cell');
                             row.appendChild(correctAnswerCell);
                             row.classList.add(userAnswerIndex === correctAnswerIndex ? 'correct-row' : 'incorrect-row');
                         } else if (hasMC && row.cells.length < 3) {
                              const emptyCell = document.createElement('td'); emptyCell.textContent = '-'; row.appendChild(emptyCell);
                         }
                     });
                     document.getElementById('reveal-section').style.display = 'none';
                 } else {
                     passwordError.style.display = 'block';
                 }
            });

             // --- Retry button logic ---
             retryButton.addEventListener('click', () => {
                 // Check the password
                 if (retryPasswordInput.value.toLowerCase() === correctPassword) {
                     retryError.style.display = 'none';
                     terminationOverlay.style.display = 'none'; // Hide the overlay

                     // **Reset the quiz state completely**
                     quizFinished = false; // Allow submission again
                     userAnswers = []; // Clear stored answers
                     deleteCookie('quizCampaignFinished'); // Remove the finished flag
                     setCookie('quizCampaignInProgress', 'true', 30); // Reset the in-progress timer

                     // Restore UI elements
                     resultsContainer.style.display = 'none'; // Hide results section
                     quizForm.style.display = 'block'; // Show the form again
                     document.querySelector('.warning-banner').style.display = 'block'; // Show warning

                     // **Reload questions to reset selections**
                     loadQuiz();

                     // Optionally clear the password field
                     retryPasswordInput.value = '';

                 } else {
                     retryError.style.display = 'block'; // Show password error
                 }
             });

            // --- TAB CHANGE / VISIBILITY DETECTION ---
            document.addEventListener('visibilitychange', () => {
                 if (document.hidden && !quizFinished && getCookie('quizCampaignInProgress') === 'true') {
                     // Try to save answers just before terminating
                     userAnswers = quizData.map((q, index) => {
                          if (q.type === "mc") {
                              const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                              return selectedOption ? parseInt(selectedOption.value) : -1;
                          } else {
                              const textarea = document.querySelector(`textarea[name="question${index}"]`);
                              return textarea ? textarea.value.trim() : "";
                          }
                     });
                     terminateQuiz("The exam has ended automatically because you switched tabs or windows.");
                 }
            });

            // --- INITIALIZE ---
            loadQuiz();
        });
    </script>

</body>
</html>
